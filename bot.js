require('dotenv').config();
const { Telegraf, Markup } = require('telegraf');

const bot = new Telegraf(process.env.BOT_TOKEN);

// ุฏฺฉูู ุดุฑูุน ู ูุนุฑู
bot.start((ctx) => {
  ctx.reply(
    'ุณูุงู ๐\nุจู ุฑุจุงุช ุชุจุฏู ูุงู ุจู ููฺฉ ุฎูุด ุงููุฏ!\nูุงู ุฑู ุจุฑุงู ุจูุฑุณุช ุง ุงุฒ ฺฉุงูุงู/ฺฏุฑูู ููุฑูุงุฑุฏ ฺฉู ุชุง ููฺฉ ูุณุชูู ุจุฏู.',
    Markup.keyboard([
      ['๐ค ุงุฑุณุงู ูุงู'],
      ['โน๏ธ ุฑุงูููุง'],
    ]).resize()
  );
});

// ุฌูุงุจ ุจู ูพุงู ยซุฑุงูููุงยป
bot.hears('โน๏ธ ุฑุงูููุง', (ctx) => {
  ctx.reply('๐ ูุงู ุฑู ูุณุชููุงู ุงุฑุณุงู ฺฉู ุง ุงุฒ ฺฉุงูุงู/ฺฏุฑูู ููุฑูุงุฑุฏ ฺฉู ุชุง ููฺฉ ูุณุชูู ุฏุฑุงูุช ฺฉู.');
});

// ุจุฑุฑุณ ููู ูพุงูโูุง
bot.on('message', async (ctx) => {
  const msg = ctx.message;

  // ุงฺฏุฑ ูุงู ูุฌูุฏ ุฏุงุฑุฏ (ฺู ูุณุชูู ฺู ููุฑูุงุฑุฏ)
  if (msg.document) {
    try {
      const fileId = msg.document.file_id;
      const fileLink = await ctx.telegram.getFileLink(fileId);
      ctx.reply(`โ ูุงู ุดูุง ุฏุฑุงูุช ุดุฏ.\n๐ ููฺฉ ูุณุชูู:\n${fileLink.href}`);
    } catch (err) {
      console.error('โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ููฺฉ ูุงู:', err.message);
      ctx.reply('โ ุฏุฑุงูุช ููฺฉ ูุงู ุจุง ุดฺฉุณุช ููุงุฌู ุดุฏ. ูุทูุงู ุฏูุจุงุฑู ุงูุชุญุงู ฺฉู ุง ูุงู ุฏฺฏุฑ ุจูุฑุณุช.');
    }
  } else if (msg.text && !msg.via_bot) {
    // ุงฺฏุฑ ูพุงู ููุท ูุชู ูุณุช ูู ูุงู ูุณุช
    ctx.reply('โ๏ธ ูุทูุงู ููุท ูุงู ุงุฑุณุงู ฺฉูุฏ ุง ููุฑูุงุฑุฏ ููุงุฏ.');
  }
});

module.exports = bot;
